<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kid Scared → Monster 01 - Liquid Paint V7</title>
</head>
<body>
    <script src="../timeline-component.js"></script>

    <script>
        // Include the base liquid paint system
        fetch('../liquid-paint-base.html')
            .then(response => response.text())
            .then(html => {
                // Extract and inject the base HTML content
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Copy styles
                doc.querySelectorAll('style').forEach(style => {
                    document.head.appendChild(style.cloneNode(true));
                });

                // Copy body content
                doc.body.querySelectorAll('*').forEach(element => {
                    document.body.appendChild(element.cloneNode(true));
                });

                // Wait for scripts to load, then initialize
                setTimeout(() => {
                    initializeTransformation();
                }, 100);
            });

        function initializeTransformation() {
            // Initialize timeline for this stage
            const timeline = initTimeline({
                currentStage: 2,
                totalStages: 4,
                interactive: false,
                onStageChange: (stage) => {
                    console.log(`Stage changed to: ${stage}`);
                }
            });

            // Configure liquid paint system for this transformation
            const config = {
                image1Url: '../images/KidScared.png',
                image2Url: '../images/Monster01.png',
                backboardUrl: '../backboard-2.html',
                stageTitle: 'Kid Scared → Monster 01',
                imageCount: 10000 // Desktop count
            };

            // Initialize the liquid paint system
            if (typeof window.initializeLiquidPaint === 'function') {
                window.initializeLiquidPaint(config);
            } else {
                // Wait for the function to be available
                setTimeout(() => {
                    if (typeof window.initializeLiquidPaint === 'function') {
                        window.initializeLiquidPaint(config);
                    } else {
                        console.error('initializeLiquidPaint function not available');
                    }
                }, 500);
            }

            // Global function for timeline progress updates
            window.updateTimelineProgress = function(percentage) {
                if (timeline && typeof timeline.trackParticleTransformation === 'function') {
                    // Convert percentage to particle count for timeline
                    const totalParticles = config.imageCount;
                    const transformedCount = Math.round((percentage / 100) * totalParticles);
                    timeline.trackParticleTransformation(transformedCount, totalParticles);
                }
            };

            console.log('Transformation 2→3 initialized: Kid Scared → Monster 01');
        }
    </script>
</body>
</html>